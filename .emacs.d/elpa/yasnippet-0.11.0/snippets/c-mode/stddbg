# -*- mode: snippet -*-
# name: stddbg
# contributor: HardDie
# key: stddbg
# --
/* DEBUG */
#include <string.h>
static unsigned int __indent = 0;
#define __my_print(__fmt, ...) fprintf(stddbg, __fmt, ##__VA_ARGS__)
#define __indent_print() int __iii; for (__iii = 0; __iii < __indent; __iii++) __my_print("|  ")
#define __log_print(__fmt, ...) __my_print("dbg  "__fmt": %s():[%d] - %s\n", ##__VA_ARGS__, __FUNCTION__, __LINE__, __FILE__ ? __FILE__ + 17 : "NULL")
#define DPRINT(__flag, __fmt, ...) \
	if (__flag) { \
		FILE* stddbg = fopen("/dev/console", "a"); while(0){__indent=0;} \
		if (stddbg != NULL) { \
			if ((__indent>0) && (0 == strncmp(__fmt, "Leave", 5) || 0 == strncmp(__fmt, "Retrn", 5))) { __indent--; } \
			__indent_print(); __log_print(__fmt, ##__VA_ARGS__); \
			if (0 == strncmp(__fmt, "Enter", 5)) { __indent++; } \
			fflush(stddbg); fclose(stddbg); \
			if (__indent == 0) __my_print("\n"); \
		} \
	}
/* DEBUG */
